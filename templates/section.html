{% extends "base.html" %}

{% block head %}
  <link rel="canonical" href="{{ section.permalink | safe }}">
  <meta property="og:title" content="{{ section.title | default(value=config.title) }}">
  <meta property="og:description" content="{{ section.description | default(value=config.description) }}">
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ section.permalink | safe }}">
  <meta name="twitter:card" content="summary">

  {% if paginator %}
    {% if paginator.previous %}
      <link rel="prev" href="{{ paginator.previous | safe }}">
    {% endif %}
    {% if paginator.next %}
      <link rel="next" href="{{ paginator.next | safe }}">
    {% endif %}
  {% endif %}

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": {% if section.title %}{{ section.title | json_encode }}{% else %}{{ config.title | json_encode }}{% endif %},
    "url": {{ section.permalink | json_encode }},
    "description": {% if section.description %}{{ section.description | json_encode }}{% else %}{{ config.description | json_encode }}{% endif %}
  }
  </script>
{% endblock head %}

{% block content %}
  {% include "partials/breadcrumbs.html" %}

  {% if section.title %}<h1>{{ section.title }}</h1>{% endif %}
  {{ section.content | safe }}

  {# Paginated listing if available, otherwise fall back to section.pages #}
  {% if paginator and paginator.pages %}
    <ul>
      {% for page in paginator.pages %}
        <li>
          <a href="{{ page.permalink }}">{{ page.title }}</a>
          {% if page.date %}<span class="muted"> — {{ page.date | date(format="%Y-%m-%d") }}</span>{% endif %}
        </li>
      {% endfor %}
    </ul>

    {% if paginator.previous or paginator.next %}
      <nav class="muted">
        {% if paginator.previous %}<a href="{{ paginator.previous }}">← Newer</a>{% endif %}
        {% if paginator.previous and paginator.next %} · {% endif %}
        {% if paginator.next %}<a href="{{ paginator.next }}">Older →</a>{% endif %}
      </nav>
    {% endif %}
  {% else %}
    {% if section.pages and section.pages | length > 0 %}
      <ul>
        {% for page in section.pages %}
          <li>
            <a href="{{ page.permalink }}">{{ page.title }}</a>
            {% if page.date %}<span class="muted"> — {{ page.date | date(format="%Y-%m-%d") }}</span>{% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">No entries yet.</p>
    {% endif %}
  {% endif %}

  {# Categories cloud (guarded to avoid nil errors) #}
  {% set cats = get_taxonomy(kind="categories") %}
  {% if cats and cats.items and cats.items | length > 0 %}
    <p class="muted">
      Browse by category:
      {% for term in cats.items %}
        <a href="{{ term.permalink }}">{{ term.name }}</a>{% if not loop.last %}, {% endif %}
      {% endfor %}
    </p>
  {% endif %}
{% endblock content %}